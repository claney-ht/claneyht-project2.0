<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayFusion - Mot de passe oublié</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== VARIABLES CSS ===== */
        :root {
            --color-blue-primary: #2563eb;
            --color-blue-light: #3b82f6;
            --color-blue-very-light: #dbeafe;
            --color-white: #ffffff;
            --color-gray-very-light: #f8fafc;
            --color-gray-light: #e2e8f0;
            --color-gray-medium: #94a3b8;
            --color-gray-dark: #334155;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-warning: #f59e0b;
            --font-family: 'Inter', sans-serif;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.25rem;
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 4rem;
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size-sm);
            line-height: 1.6;
            color: var(--color-gray-dark);
            background-color: var(--color-gray-very-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-sm);
        }

        /* ===== HEADER ===== */
        .pf-forgot-header {
            padding: var(--spacing-md) 0;
            text-align: center;
            border-bottom: 1px solid var(--color-gray-light);
            background: var(--color-white);
        }

        .pf-forgot-header h1 {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--color-blue-primary);
        }

        .pf-forgot-header p {
            color: var(--color-gray-medium);
            margin-top: var(--spacing-xs);
        }

        /* ===== MAIN CONTENT ===== */
        .pf-forgot-main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-xl) 0;
        }

        .pf-forgot-container {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            padding: var(--spacing-xl);
            width: 100%;
            max-width: 500px;
        }

        /* ===== FORM STYLES ===== */
        .pf-form-step {
            display: none;
        }

        .pf-form-step.active {
            display: block;
        }

        .pf-form-title {
            font-size: var(--font-size-base);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--color-gray-dark);
            text-align: center;
        }

        .pf-form-subtitle {
            text-align: center;
            color: var(--color-gray-medium);
            margin-bottom: var(--spacing-lg);
        }

        .pf-form-group {
            margin-bottom: var(--spacing-lg);
        }

        .pf-form-label {
            display: block;
            font-weight: 500;
            margin-bottom: var(--spacing-xs);
            color: var(--color-gray-dark);
        }

        .pf-form-label i {
            margin-right: 0.5rem;
            color: var(--color-gray-medium);
        }

        .pf-form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--color-gray-light);
            border-radius: var(--border-radius);
            font-size: var(--font-size-sm);
            color: var(--color-gray-dark);
            background-color: var(--color-white);
            transition: border-color 0.2s ease;
        }

        .pf-form-input:focus {
            outline: none;
            border-color: var(--color-blue-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .pf-input-with-icon {
            position: relative;
        }

        .pf-input-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-gray-medium);
            cursor: pointer;
        }

        /* ===== VERIFICATION CODE ===== */
        .pf-code-container {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: center;
            margin-bottom: var(--spacing-lg);
        }

        .pf-code-input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            border: 2px solid var(--color-gray-light);
            border-radius: var(--border-radius);
            background: var(--color-white);
            color: var(--color-gray-dark);
            transition: all 0.2s ease;
        }

        .pf-code-input:focus {
            outline: none;
            border-color: var(--color-blue-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .pf-code-input.filled {
            border-color: var(--color-blue-primary);
            background: var(--color-blue-very-light);
        }

        /* ===== RESEND CODE ===== */
        .pf-resend-code {
            text-align: center;
            margin-top: var(--spacing-md);
        }

        .pf-resend-btn {
            background: none;
            border: none;
            color: var(--color-blue-primary);
            font-weight: 500;
            cursor: pointer;
            padding: 0;
            font-size: var(--font-size-sm);
        }

        .pf-resend-btn:disabled {
            color: var(--color-gray-medium);
            cursor: not-allowed;
        }

        .pf-resend-timer {
            color: var(--color-gray-medium);
            font-size: 0.8125rem;
            margin-top: var(--spacing-xs);
        }

        /* ===== BOUTONS ===== */
        .pf-form-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-xl);
            gap: var(--spacing-sm);
        }

        .pf-btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
            flex: 1;
        }

        .pf-btn-primary {
            background-color: var(--color-blue-primary);
            color: var(--color-white);
        }

        .pf-btn-primary:hover {
            background-color: #1d4ed8;
        }

        .pf-btn-secondary {
            background-color: var(--color-gray-very-light);
            color: var(--color-gray-dark);
            border: 1px solid var(--color-gray-light);
        }

        .pf-btn-secondary:hover {
            background-color: var(--color-gray-light);
        }

        .pf-btn-success {
            background-color: var(--color-success);
            color: var(--color-white);
        }

        .pf-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== ERROR MESSAGES ===== */
        .pf-error-message {
            color: var(--color-error);
            font-size: 0.8125rem;
            margin-top: 0.25rem;
            display: none;
        }

        .pf-error-message.show {
            display: block;
        }

        .pf-success-message {
            color: var(--color-success);
            font-size: 0.8125rem;
            margin-top: 0.25rem;
            display: none;
        }

        .pf-success-message.show {
            display: block;
        }

        /* ===== INFO BOX ===== */
        .pf-info-box {
            background: var(--color-blue-very-light);
            border: 1px solid var(--color-blue-light);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            color: var(--color-gray-dark);
        }

        .pf-info-box i {
            color: var(--color-blue-primary);
            margin-right: 0.5rem;
        }

        /* ===== FOOTER ===== */
        .pf-forgot-footer {
            text-align: center;
            padding: var(--spacing-lg) 0;
            color: var(--color-gray-medium);
            font-size: 0.8125rem;
            border-top: 1px solid var(--color-gray-light);
            background: var(--color-white);
        }

        .pf-forgot-footer a {
            color: var(--color-blue-primary);
            text-decoration: none;
            font-weight: 500;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 600px) {
            .pf-forgot-container {
                padding: var(--spacing-lg);
                margin: 0 var(--spacing-sm);
            }
            
            .pf-code-container {
                gap: 0.5rem;
            }
            
            .pf-code-input {
                width: 40px;
                height: 50px;
                font-size: 1.25rem;
            }
            
            .pf-form-buttons {
                flex-direction: column;
            }
            
            .pf-btn {
                width: 100%;
            }
        }

        @media (max-width: 400px) {
            .pf-code-input {
                width: 35px;
                height: 45px;
                font-size: 1.125rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="pf-forgot-header">
        <div class="container">
            <h1>PayFusion</h1>
            <p>Réinitialisation du mot de passe</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pf-forgot-main">
        <div class="container">
            <div class="pf-forgot-container">
                <!-- Step 1: Enter Email/Phone -->
                <form id="forgotPasswordForm">
                    <div id="step1" class="pf-form-step active">
                        <h3 class="pf-form-title">
                            <i class="fas fa-key"></i> Mot de passe oublié ?
                        </h3>
                        <p class="pf-form-subtitle">
                            Entrez votre email ou numéro de téléphone pour recevoir un code de réinitialisation
                        </p>
                        
                        <div class="pf-info-box">
                            <i class="fas fa-info-circle"></i>
                            Le code de réinitialisation sera envoyé par email ou WhatsApp selon votre méthode de contact préférée.
                        </div>
                        
                        <div class="pf-form-group">
                            <label for="recoveryEmail" class="pf-form-label">
                                <i class="fas fa-envelope"></i> Email ou Téléphone
                            </label>
                            <input 
                                type="text" 
                                id="recoveryEmail" 
                                class="pf-form-input" 
                                placeholder="exemple@email.com ou +509XXXXXXXX"
                                required
                            >
                            <div id="recoveryError" class="pf-error-message">
                                Veuillez entrer un email ou numéro valide
                            </div>
                        </div>
                        
                        <div class="pf-form-buttons">
                            <a href="login.html" class="pf-btn pf-btn-secondary">
                                <i class="fas fa-arrow-left"></i> Retour à la connexion
                            </a>
                            <button type="button" class="pf-btn pf-btn-primary" id="sendCodeBtn">
                                <i class="fas fa-paper-plane"></i> Envoyer le code
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Verification Code -->
                    <div id="step2" class="pf-form-step">
                        <h3 class="pf-form-title">
                            <i class="fas fa-shield-alt"></i> Code de vérification
                        </h3>
                        <p class="pf-form-subtitle" id="codeSentTo">
                            Code envoyé à votre adresse email
                        </p>
                        
                        <div class="pf-form-group">
                            <div class="pf-code-container" id="codeContainer">
                                <!-- Code inputs will be generated by JavaScript -->
                            </div>
                            <div id="codeError" class="pf-error-message">
                                Code invalide. Veuillez vérifier et réessayer.
                            </div>
                            <div id="codeSuccess" class="pf-success-message">
                                Code vérifié avec succès !
                            </div>
                        </div>
                        
                        <div class="pf-resend-code">
                            <button type="button" class="pf-resend-btn" id="resendCodeBtn" disabled>
                                Renvoyer le code
                            </button>
                            <div class="pf-resend-timer" id="resendTimer">
                                Vous pourrez renvoyer un code dans <span id="timerCount">60</span> secondes
                            </div>
                        </div>
                        
                        <div class="pf-form-buttons">
                            <button type="button" class="pf-btn pf-btn-secondary" id="backToStep1Btn">
                                <i class="fas fa-arrow-left"></i> Retour
                            </button>
                            <button type="button" class="pf-btn pf-btn-primary" id="verifyCodeBtn" disabled>
                                <i class="fas fa-check"></i> Vérifier le code
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: New Password -->
                    <div id="step3" class="pf-form-step">
                        <h3 class="pf-form-title">
                            <i class="fas fa-lock"></i> Nouveau mot de passe
                        </h3>
                        <p class="pf-form-subtitle">
                            Créez un nouveau mot de passe sécurisé pour votre compte
                        </p>
                        
                        <div class="pf-form-group">
                            <label for="newPassword" class="pf-form-label">
                                <i class="fas fa-lock"></i> Nouveau mot de passe
                            </label>
                            <div class="pf-input-with-icon">
                                <input 
                                    type="password" 
                                    id="newPassword" 
                                    class="pf-form-input" 
                                    placeholder="Minimum 8 caractères"
                                    required
                                >
                                <i class="fas fa-eye pf-input-icon" id="toggleNewPassword"></i>
                            </div>
                            <div id="newPasswordError" class="pf-error-message">
                                Minimum 8 caractères avec majuscule, minuscule et chiffre
                            </div>
                        </div>
                        
                        <div class="pf-form-group">
                            <label for="confirmNewPassword" class="pf-form-label">
                                <i class="fas fa-lock"></i> Confirmer le mot de passe
                            </label>
                            <div class="pf-input-with-icon">
                                <input 
                                    type="password" 
                                    id="confirmNewPassword" 
                                    class="pf-form-input" 
                                    placeholder="Répétez le nouveau mot de passe"
                                    required
                                >
                                <i class="fas fa-eye pf-input-icon" id="toggleConfirmNewPassword"></i>
                            </div>
                            <div id="confirmNewPasswordError" class="pf-error-message">
                                Les mots de passe ne correspondent pas
                            </div>
                        </div>
                        
                        <div class="pf-form-buttons">
                            <button type="button" class="pf-btn pf-btn-secondary" id="backToStep2Btn">
                                <i class="fas fa-arrow-left"></i> Retour
                            </button>
                            <button type="submit" class="pf-btn pf-btn-success" id="resetPasswordBtn">
                                <i class="fas fa-sync-alt"></i> Réinitialiser le mot de passe
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Success -->
                    <div id="step4" class="pf-form-step">
                        <div style="text-align: center; padding: var(--spacing-lg) 0;">
                            <div style="font-size: 3rem; color: var(--color-success); margin-bottom: var(--spacing-md);">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h3 class="pf-form-title">Mot de passe réinitialisé !</h3>
                            <p class="pf-form-subtitle">
                                Votre mot de passe a été modifié avec succès. Vous pouvez maintenant vous connecter avec vos nouvelles informations.
                            </p>
                            
                            <div style="margin-top: var(--spacing-xl);">
                                <a href="login.html" class="pf-btn pf-btn-primary" style="display: inline-flex; width: auto;">
                                    <i class="fas fa-sign-in-alt"></i> Se connecter
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div style="text-align: center; margin-top: var(--spacing-lg);">
                    <p>Vous n'avez pas de compte ? <a href="register.html" class="pf-btn pf-btn-secondary" style="display: inline-flex; width: auto; margin-top: var(--spacing-sm);">
                        <i class="fas fa-user-plus"></i> Créer un compte
                    </a></p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="pf-forgot-footer">
        <div class="container">
            <p>Besoin d'aide ? Contactez-nous: <a href="https://wa.me/50939442808">WhatsApp +509 3944 2808</a></p>
            <p>&copy; 2024 PayFusion. Tous droits réservés.</p>
        </div>
    </footer>

    <script>
        // State management
        let currentStep = 1;
        let recoveryEmail = '';
        let verificationCode = '';
        let countdownInterval = null;
        let countdownSeconds = 60;
        
        // DOM Elements
        const formSteps = document.querySelectorAll('.pf-form-step');
        const codeContainer = document.getElementById('codeContainer');
        const codeSentTo = document.getElementById('codeSentTo');
        const resendBtn = document.getElementById('resendCodeBtn');
        const resendTimer = document.getElementById('resendTimer');
        const timerCount = document.getElementById('timerCount');
        
        // Validation functions
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function isValidPhone(phone) {
            const re = /^\+?[0-9]{10,15}$/;
            return re.test(phone.replace(/\s/g, ''));
        }
        
        function isValidPassword(password) {
            return password.length >= 8 && 
                   /[A-Z]/.test(password) && 
                   /[a-z]/.test(password) && 
                   /\d/.test(password);
        }
        
        // Generate random 6-digit code
        function generateVerificationCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }
        
        // Create code input fields
        function createCodeInputs() {
            codeContainer.innerHTML = '';
            for (let i = 0; i < 6; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.maxLength = 1;
                input.className = 'pf-code-input';
                input.dataset.index = i;
                input.addEventListener('input', handleCodeInput);
                input.addEventListener('keydown', handleCodeKeyDown);
                codeContainer.appendChild(input);
            }
            
            // Focus first input
            codeContainer.firstChild.focus();
        }
        
        // Handle code input
        function handleCodeInput(e) {
            const input = e.target;
            const index = parseInt(input.dataset.index);
            const value = input.value;
            
            // Only allow digits
            if (!/^\d$/.test(value)) {
                input.value = '';
                return;
            }
            
            // Add filled class
            input.classList.add('filled');
            
            // Move to next input if available
            if (index < 5 && value) {
                const nextInput = codeContainer.querySelector(`[data-index="${index + 1}"]`);
                if (nextInput) {
                    nextInput.focus();
                }
            }
            
            // Check if all inputs are filled
            checkCodeCompletion();
        }
        
        // Handle keyboard navigation in code inputs
        function handleCodeKeyDown(e) {
            const input = e.target;
            const index = parseInt(input.dataset.index);
            
            // Handle backspace
            if (e.key === 'Backspace') {
                if (!input.value && index > 0) {
                    // Move to previous input
                    const prevInput = codeContainer.querySelector(`[data-index="${index - 1}"]`);
                    if (prevInput) {
                        prevInput.focus();
                        prevInput.value = '';
                        prevInput.classList.remove('filled');
                    }
                } else {
                    input.classList.remove('filled');
                }
            }
            
            // Handle arrow keys
            if (e.key === 'ArrowLeft' && index > 0) {
                const prevInput = codeContainer.querySelector(`[data-index="${index - 1}"]`);
                if (prevInput) prevInput.focus();
            }
            
            if (e.key === 'ArrowRight' && index < 5) {
                const nextInput = codeContainer.querySelector(`[data-index="${index + 1}"]`);
                if (nextInput) nextInput.focus();
            }
        }
        
        // Check if code is complete
        function checkCodeCompletion() {
            const inputs = codeContainer.querySelectorAll('.pf-code-input');
            let code = '';
            let allFilled = true;
            
            inputs.forEach(input => {
                code += input.value;
                if (!input.value) allFilled = false;
            });
            
            // Enable verify button if all inputs are filled
            document.getElementById('verifyCodeBtn').disabled = !allFilled;
            
            return { code, allFilled };
        }
        
        // Get entered code
        function getEnteredCode() {
            const inputs = codeContainer.querySelectorAll('.pf-code-input');
            let code = '';
            inputs.forEach(input => {
                code += input.value;
            });
            return code;
        }
        
        // Show specific step
        function showStep(step) {
            // Hide all steps
            formSteps.forEach(formStep => {
                formStep.classList.remove('active');
            });
            
            // Show current step
            document.getElementById(`step${step}`).classList.add('active');
            
            // Update code sent message
            if (step === 2 && recoveryEmail) {
                const maskedEmail = maskEmail(recoveryEmail);
                codeSentTo.textContent = `Code envoyé à ${maskedEmail}`;
            }
        }
        
        // Mask email for privacy
        function maskEmail(email) {
            if (isValidEmail(email)) {
                const [username, domain] = email.split('@');
                const maskedUsername = username.charAt(0) + '***' + username.charAt(username.length - 1);
                return maskedUsername + '@' + domain;
            }
            return email;
        }
        
        // Start countdown timer
        function startCountdown() {
            countdownSeconds = 60;
            timerCount.textContent = countdownSeconds;
            resendBtn.disabled = true;
            resendTimer.style.display = 'block';
            
            countdownInterval = setInterval(() => {
                countdownSeconds--;
                timerCount.textContent = countdownSeconds;
                
                if (countdownSeconds <= 0) {
                    clearInterval(countdownInterval);
                    resendBtn.disabled = false;
                    resendTimer.style.display = 'none';
                }
            }, 1000);
        }
        
        // Reset form
        function resetForm() {
            document.getElementById('recoveryEmail').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
            
            // Reset errors
            document.querySelectorAll('.pf-error-message, .pf-success-message').forEach(msg => {
                msg.classList.remove('show');
            });
            
            // Reset code inputs
            const codeInputs = codeContainer.querySelectorAll('.pf-code-input');
            codeInputs.forEach(input => {
                input.value = '';
                input.classList.remove('filled');
            });
            
            document.getElementById('verifyCodeBtn').disabled = true;
        }
        
        // Initialize
        function init() {
            createCodeInputs();
            
            // Password toggle
            document.getElementById('toggleNewPassword').addEventListener('click', function() {
                const passwordInput = document.getElementById('newPassword');
                const type = passwordInput.type === 'password' ? 'text' : 'password';
                passwordInput.type = type;
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });
            
            document.getElementById('toggleConfirmNewPassword').addEventListener('click', function() {
                const passwordInput = document.getElementById('confirmNewPassword');
                const type = passwordInput.type === 'password' ? 'text' : 'password';
                passwordInput.type = type;
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });
            
            // Step 1: Send code
            document.getElementById('sendCodeBtn').addEventListener('click', function() {
                const emailInput = document.getElementById('recoveryEmail');
                const email = emailInput.value.trim();
                
                // Reset error
                document.getElementById('recoveryError').classList.remove('show');
                
                // Validate
                if (!isValidEmail(email) && !isValidPhone(email)) {
                    document.getElementById('recoveryError').classList.add('show');
                    emailInput.focus();
                    return;
                }
                
                // Store recovery email
                recoveryEmail = email;
                verificationCode = generateVerificationCode();
                
                // Show loading
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Envoi en cours...';
                this.disabled = true;
                
                // Simulate sending code
                setTimeout(() => {
                    // In real app, send code via EmailJS/WhatsApp
                    console.log(`Code de vérification pour ${email}: ${verificationCode}`);
                    
                    // Move to step 2
                    currentStep = 2;
                    showStep(currentStep);
                    startCountdown();
                    
                    // Reset button
                    this.innerHTML = originalText;
                    this.disabled = false;
                }, 1500);
            });
            
            // Back to step 1
            document.getElementById('backToStep1Btn').addEventListener('click', function() {
                currentStep = 1;
                showStep(currentStep);
                resetForm();
            });
            
            // Verify code
            document.getElementById('verifyCodeBtn').addEventListener('click', function() {
                const enteredCode = getEnteredCode();
                
                // Reset messages
                document.getElementById('codeError').classList.remove('show');
                document.getElementById('codeSuccess').classList.remove('show');
                
                // Validate
                if (enteredCode !== verificationCode) {
                    document.getElementById('codeError').classList.add('show');
                    
                    // Shake animation for wrong code
                    const inputs = codeContainer.querySelectorAll('.pf-code-input');
                    inputs.forEach(input => {
                        input.style.animation = 'none';
                        setTimeout(() => {
                            input.style.animation = 'shake 0.5s';
                        }, 10);
                    });
                    return;
                }
                
                // Code is correct
                document.getElementById('codeSuccess').classList.add('show');
                
                // Move to step 3 after delay
                setTimeout(() => {
                    currentStep = 3;
                    showStep(currentStep);
                }, 1000);
            });
            
            // Back to step 2
            document.getElementById('backToStep2Btn').addEventListener('click', function() {
                currentStep = 2;
                showStep(currentStep);
            });
            
            // Resend code
            document.getElementById('resendCodeBtn').addEventListener('click', function() {
                if (this.disabled) return;
                
                // Generate new code
                verificationCode = generateVerificationCode();
                
                // Show loading
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Renvoi en cours...';
                
                // Simulate resending
                setTimeout(() => {
                    console.log(`Nouveau code pour ${recoveryEmail}: ${verificationCode}`);
                    
                    // Reset code inputs
                    const inputs = codeContainer.querySelectorAll('.pf-code-input');
                    inputs.forEach(input => {
                        input.value = '';
                        input.classList.remove('filled');
                    });
                    
                    // Focus first input
                    codeContainer.firstChild.focus();
                    
                    // Reset button
                    this.innerHTML = 'Renvoyer le code';
                    
                    // Start countdown again
                    startCountdown();
                }, 1000);
            });
            
            // Form submission
            document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;
                
                // Reset errors
                document.getElementById('newPasswordError').classList.remove('show');
                document.getElementById('confirmNewPasswordError').classList.remove('show');
                
                // Validate
                let isValid = true;
                
                if (!isValidPassword(newPassword)) {
                    document.getElementById('newPasswordError').classList.add('show');
                    isValid = false;
                }
                
                if (newPassword !== confirmPassword) {
                    document.getElementById('confirmNewPasswordError').classList.add('show');
                    isValid = false;
                }
                
                if (!isValid) return;
                
                // Show loading
                const submitBtn = document.getElementById('resetPasswordBtn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Réinitialisation...';
                submitBtn.disabled = true;
                
                // Simulate password reset
                setTimeout(() => {
                    // In real app, update password in Firebase
                    console.log(`Mot de passe mis à jour pour ${recoveryEmail}`);
                    
                    // Move to success step
                    currentStep = 4;
                    showStep(currentStep);
                    
                    // Reset submit button (not visible now)
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }, 2000);
            });
        }
        
        // Add shake animation for wrong code
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
        
        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>